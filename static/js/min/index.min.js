function init_default_content(){content={title:words_default[0],text:[]};for(var t=1;t<words_default.length;t++)content.text.push(words_default[t])}function set_content_html(){$("#spritz_words").append("<header>"+content.title+"</header>"),content.text.forEach(function(t){$("#spritz_words").append("<p>"+t+"</p>")})}function words_load(){localStorage.jqspritz?(local_spritz=JSON.parse(localStorage.jqspritz),local_spritz.night&&(night=!0,$("html").addClass("night")),local_spritz.autosave&&(autosave=!0,$("html").addClass("autosave"),$("#autosave_checkbox").prop("checked",!0)),$wpm.val(local_spritz.wpm),interval=6e4/local_spritz.wpm,spritz_zoom(0),content=local_spritz.content,word_index=local_spritz.word,words_set(),word_show(),word_update(),spritz_pause(!0),spritz_alert("loaded")):(init_default_content(),word_index=0,words_set(),word_show(),word_update(),spritz_pause(!0))}function words_save(){local_spritz={word:word_index,content:content,wpm:$wpm.val(),night:night,autosave:autosave,zoom:zoom},localStorage.jqspritz=JSON.stringify(local_spritz),autosave?button_flash("save",500):spritz_alert("saved")}function words_set(){set_content_html(),words=content.text.join(" ").trim().replace(/([\u2010-\u2014])(\S)/g,"$1 $2").replace(/([\.\?\!\;\:\)])/g,"$1 � ").split(/\s+/)}function word_show(){0>word_index&&(word_index=0),word_index>=words.length&&(word_index=words.length-1),$("#spritz_progress").width(100*word_index/words.length+"%");var t=words[word_index],e=Math.round(.4*(t.length+1))-1;"�"!=t&&$space.html("<div>"+t.slice(0,e)+"</div><div>"+t[e]+"</div><div>"+t.slice(e+1)+"</div>")}function word_next(){word_index++,word_show()}function word_prev(){word_index--,word_show()}function word_update(){spritz=setInterval(function(){word_next(),word_index+1==words.length&&(setTimeout(function(){$space.html(""),spritz_pause(!0),word_index=0,word_show()},interval),clearInterval(spritz))},interval)}function spritz_pause(t){paused||(clearInterval(spritz),paused=!0,$("html").addClass("paused"),autosave&&!t&&words_save())}function spritz_play(){word_update(),paused=!1,$("html").removeClass("paused")}function spritz_flip(){paused?spritz_play():spritz_pause()}function spritz_speed(){interval=6e4/$("#spritz_wpm").val(),paused||(clearInterval(spritz),word_update()),$("#spritz_save").removeClass("saved loaded")}function spritz_faster(){$("#spritz_wpm").val(parseInt($("#spritz_wpm").val())+50),spritz_speed()}function spritz_slower(){$("#spritz_wpm").val()>=100&&$("#spritz_wpm").val(parseInt($("#spritz_wpm").val())-50),spritz_speed()}function spritz_back(){spritz_pause(),word_index>=1&&word_prev()}function spritz_forward(){spritz_pause(),word_index<words.length&&word_next()}function spritz_zoom(t){zoom+=t,$("#spritz").css("font-size",zoom+"em")}function spritz_refresh(){clearInterval(spritz),words_set(),spritz_pause(),word_index=0,word_show()}function spritz_select(){window.location=location.origin+location.pathname}function spritz_expand(){$("html").toggleClass("fullscreen")}function spritz_autosave(){$("html").toggleClass("autosave"),autosave=!autosave,autosave?$("#autosave_checkbox").prop("checked",!0):$("#autosave_checkbox").prop("checked",!1)}function spritz_status(t){return $("#img-loading").hide(),$("#alert").attr("title","").text(t)}function spritz_alert(t){var e="";switch(t){case"loaded":e="Data loaded from local storage";break;case"saved":e="Settings have been saved in local storage for the next time you visit";break;case"erased":e="Your saved settings have been erased"}return spritz_status(e).fadeIn().delay(2e3).fadeOut()}function spritz_error(t){return spritz_status(t).fadeIn().delay(5e3).fadeOut()}function button_flash(t,e){var r=$(".controls a."+t);r.addClass("active"),"undefined"==typeof e&&(e=100),setTimeout(function(){r.removeClass("active")},e)}function get_url_param(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),r=e.exec(location.search);return null==r?"":decodeURIComponent(r[1].replace(/\+/g," "))}function preproc_text(t,e,r){r=$.trim(r).replace(/\s+/g," ");var a=t+e+r;return a.replace(/\./g,". ").replace(/\?/g,"? ").replace(/\!/g,"! ")}function get_parser(t){return"string"==typeof parsers&&(parsers=JSON.parse(parsers)),parser=parsers[t],parser.name=t,parser}function spritzify_url(t){var e="http";if(t.length>e.length){var r=t.substring(0,e.length).toLowerCase();r!=e&&(t=e+"://"+t)}article_url=document.getElementById("article-url"),article_url.href=t;var a=20,o="/"===article_url.pathname?"":article_url.pathname,s=article_url.hostname+o,i=s.substring(0,a);$("#alert").text("Loading "+i+" ...").attr("title","Loading "+s).add("#img-loading").fadeIn(),spritzify_url_with(t,["Readability","SpritsIt"])}function spritzify_url_with(t,e){try{var r=e.shift(),a=get_parser(r),o=a.uri+"?token="+a.token+"&url="+encodeURIComponent(t)+"&callback=?";r='Parser "'+a.name+'"',console.log(r+": requesting "+o),jQuery.getJSON(o,function(a){if(a.error)return spritz_error("Article extraction failed."),void 0;if(0==a.word_count)return console.log(r+": word count is zero, trying alternative API..."),spritzify_url_with(t,e);var o="";""!==a.title&&(o=a.title,null!==a.author&&(o=o+", by "+a.author));var s=jQuery(a.content).text(),i=jQuery.trim(s);""===i&&(i=a.content),content={title:o,text:i.split(/\n\n/)},spritz_status(""),words_set(),word_index=0,word_show(),spritz_pause(!0)}).done(function(){console.log(r+": done.")}).fail(function(t,e,a){var o=e+", "+a;console.log(r+": fail: "+o),spritz_error("Article extraction failed.")}).always(function(){console.log(r+": always.")})}catch(s){console.log("Error in : "+s),spritz_error("Article extraction failed.")}}function create_bookmarklet(){var t=location.origin+location.pathname,e="javascript:"+encodeURIComponent('function iptxt(){var d=document;try{if(!d.body)throw(0);window.location="'+t+'?url="+encodeURIComponent(d.location.href);}catch(e){alert("Please wait until the page has loaded.");}}iptxt();void(0)');$("#bookmarklet").attr("href",e),$("#bookmarklet").click(function(){return!1}),$("#bookmarklet-code").val(e),$("#bookmarklet-code").click(function(){this.focus(),this.select()})}var $wpm=$("#spritz_wpm"),interval=6e4/$wpm.val(),paused=!1,$space=$("#spritz_word"),night=!1,zoom=1,autosave=!1,local_spritz={},content={},words=[],word_index=0;$("#spritz_wpm").on("input",function(){spritz_speed()}),$(".controls").on("click","a, label",function(){switch(this.id){case"spritz_slower":spritz_slower();break;case"spritz_faster":spritz_faster();break;case"spritz_save":words_save();break;case"spritz_pause":spritz_flip();break;case"spritz_smaller":spritz_zoom(-.1);break;case"spritz_bigger":spritz_zoom(.1);break;case"spritz_autosave":spritz_autosave();break;case"spritz_refresh":spritz_refresh();break;case"spritz_select":spritz_select();break;case"spritz_expand":spritz_expand()}return!1}),$(".controls").on("mousedown","a",function(){switch(this.id){case"spritz_back":spritz_jog_back=setInterval(function(){spritz_back()},100);break;case"spritz_forward":spritz_jog_forward=setInterval(function(){spritz_forward()},100)}}),$(".controls").on("mouseup","a",function(){switch(this.id){case"spritz_back":clearInterval(spritz_jog_back);break;case"spritz_forward":clearInterval(spritz_jog_forward)}}),$(document).on("keyup",function(t){if("body"==t.target.tagName.toLowerCase())switch(t.keyCode){case 32:spritz_flip(),button_flash("pause");break;case 37:spritz_back(),button_flash("back");break;case 38:spritz_faster(),button_flash("faster");break;case 39:spritz_forward(),button_flash("forward");break;case 40:spritz_slower(),button_flash("slower")}}),$(document).on("keydown",function(t){if("body"==t.target.tagName.toLowerCase())switch(t.keyCode){case 37:spritz_back(),button_flash("back");break;case 39:spritz_forward(),button_flash("forward")}}),$(".light").on("click",function(){return $("html").toggleClass("night"),night=!night,!1}),$("a.toggle").on("click",function(){return $(this).siblings(".togglable").slideToggle(),!1}),$("#erase-storage").on("click",function(){return delete localStorage.jqspritz,spritz_alert("erased"),!1}),$(document).ready(function(){create_bookmarklet(),custom_url=get_url_param("url"),custom_url?spritzify_url(custom_url):words_load()}),window.addEventListener("pageshow",function(){spritz_pause(!0)},!1),window.addEventListener("pagehide",function(){spritz_pause(!0)},!1);